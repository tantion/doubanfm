!function(){function a(a,b){return function(){var c=E[b],d=this;c&&clearTimeout(c),E[b]=setTimeout(function(){a.apply(d,arguments)},300)}}var b=8,c=window.dui||{},d="dui-dialog",e=[],f=null,g=$.browser.msie&&"6.0"===$.browser.version?!0:!1,h={},i={},j="j_close_dialog",k="dui-dialog",l="dui-dialog-close",m="dui-dialog-shd",n="dui-dialog-content",o="dui-dialog-iframe",p="dui-dialog-msk",q="确定",r="取消",s="提示",t="下载中，请稍候...",u='<div id="{ID}" class="'+k+' {CLS}" style="{CSS_ISHIDE}">                <span class="'+m+'"></span>                <div class="'+n+'">                    {BN_CLOSE}                    {TITLE}                    <div class="bd">{BODY}</div>                </div>            </div>',v='<a href="#" class="'+j+" "+l+'">X</a>',w='<div class="hd"><h3>{TITLE}</h3></div>',x='<iframe class="'+o+'"></iframe>',y='<div class="'+p+'"></div>',z={confirm:{text:q,method:function(a){a.close()}},cancel:{text:r,method:function(a){a.close()}}},A={url:"",nodeId:"",cls:"",content:"",title:s,width:0,height:0,visible:!1,modal:!1,iframe:!1,maxWidth:960,autoupdate:!1,cache:!0,buttons:[],callback:null,dataType:"text",isStick:!1,isHideClose:!1,isHideTitle:!1},B=function(a,b){var c,d={};for(c in b)b.hasOwnProperty(c)&&(d[c]=void 0===a[c]?b[c]:a[c]);return d},C=function(a){for(var b,c=a.elements,d=0,e=[],f={"select-one":function(a){return encodeURIComponent(a.name)+"="+encodeURIComponent(a.options[a.selectedIndex].value)},"select-multiple":function(a){for(var b,c=0,d=[];b=a.options[c++];)b.selected&&d.push(encodeURIComponent(a.name)+"="+encodeURIComponent(b.value));return d.join("&")},radio:function(a){return a.checked?encodeURIComponent(a.name)+"="+encodeURIComponent(a.value):void 0},checkbox:function(a){return a.checked?encodeURIComponent(a.name)+"="+encodeURIComponent(a.value):void 0}};b=c[d++];)e.push(f[b.type]?f[b.type](b):encodeURIComponent(b.name)+"="+encodeURIComponent(b.value));return e.join("&").replace(/\&{2,}/g,"&")},D=function(a){var b=a||{};this.config=B(b,A),this.init()};D.prototype={init:function(){return this.config?(this.render(),this.bind(),this):void 0},render:function(a){var b=this.config,c=b.nodeId||d+e.length;e.push(c);var f=$("body"),g=f.find("."+p),h="object"==typeof b.content?$(b.content).html():b.content;return f.append(u.replace("{ID}",c).replace("{CSS_ISHIDE}",b.visible?"":"visibility:hidden;top:-999em;left:-999em;").replace("{CLS}",b.cls).replace("{TITLE}",w.replace("{TITLE}",b.title)).replace("{BN_CLOSE}",v).replace("{BODY}",h||a||"")),b.modal&&!g.length?(f.append(y),this.msk=$("."+p)):this.msk=g.eq(0),this.nodeId=c,this.node=$("#"+c),this.title=$(".hd",this.node),this.body=$(".bd",this.node),this.btnClose=$("."+l,this.node),this.shadow=$("."+m,this.node),this.iframe=$("."+o,this.node),this.set(b),this},bind:function(){var b=this;return g||$(window).bind({resize:a(function(){b.updatePosition()},"pos"),scroll:a(function(){b.updatePosition()},"pos")}),b.node.delegate("."+j,"click",function(a){b.close(),a.preventDefault()}),b.node.find("."+l).bind("click",function(a){b.close(),a.preventDefault()}),$("body").keypress(function(a){27===a.keyCode&&b.close()}),this},updateSize:function(){var a,c=this.node.width(),d=$(window).width(),e=$(window).height(),f=this.config;$(".bd",this.node).css({height:"auto","overflow-x":"visible","overflow-y":"visible"}),a=this.node.height();var g=2*b;return f.maxWidth=Math.min(f.maxWidth,d-g),c>f.maxWidth&&(c=f.maxWidth,this.node.css("width",c+"px")),a>e&&$(".bd",this.node).css({height:e-150+"px","overflow-x":"hidden","overflow-y":"auto"}),a=this.node.height(),this.shadow.width(c),this.shadow.height(a),this.iframe.width(c+g).height(a+g),this},updatePosition:function(){if(!this.config.isStick){var a=this.node.width(),c=this.node.height(),d=$(window),e=g?d.scrollTop():0;return this.node.css({left:Math.floor(d.width()/2-a/2)+"px",top:Math.floor(d.height()/2-c/2-b)+e+"px"}),this}},set:function(a){var b,c,d=this.nodeId,e=this.nodeId||e,f=[],g=this,j=function(a){return f.push(0),d+"-"+a+"-"+f.length};if(!a)return this;a.width&&(this.node.css("width",a.width+"px"),this.config.width=a.width),a.height&&(this.node.css("height",a.height+"px"),this.config.height=a.height),$.isArray(a.buttons)&&a.buttons[0]?(c=$(".ft",this.node),b=[],$(a.buttons).each(function(){var a=arguments[1],c=j("bn");"string"==typeof a&&(a=z[a]),a.text&&(b.push(a.href?'<a class="'+(a.cls||"")+'" id="'+c+'" href="'+a.href+'">'+a.text+"</a> ":'<span class="bn-flat '+(a.cls||"")+'"><input type="button" id="'+c+'" class="'+e+'-bn" value="'+a.text+'" /></span> '),i[c]=a.method)}),c[0]?c.html(b.join("")):c=this.body.parent().append('<div class="ft">'+b.join("")+"</div>"),this.footer=$(".ft",this.node),$(".ft input, .ft a",this.node).click(function(a){var b=this.id&&i[this.id];if(b)var c=b.call(this,g);c&&(a.preventDefault(),"string"==typeof c&&alert(c))})):(this.footer=$(".ft",this.node),this.footer.html("")),"undefined"!=typeof a.isHideClose&&(a.isHideClose?this.btnClose.hide():this.btnClose.show(),this.config.isHideClose=a.isHideClose),"undefined"!=typeof a.isHideTitle&&(a.isHideTitle?this.title.hide():this.title.show(),this.config.isHideTitle=a.isHideTitle),a.title&&(this.setTitle(a.title),this.config.title=a.title),"undefined"!=typeof a.iframe&&(a.iframe?this.iframe[0]?this.iframe.show():(this.node.prepend(x),this.iframe=$("."+o,this.node)):this.iframe.hide(),this.config.iframe=a.iframe),a.content&&(this.body.html("object"==typeof a.content?$(a.content).html():a.content),this.config.content=a.content),a.url&&(a.cache&&h[a.url]?("text"!==a.dataType&&a.dataType||this.setContent(h[a.url]),a.callback&&a.callback(h[a.url],this)):"json"===a.dataType?(this.setContent(t),this.footer&&this.footer.hide(),$.getJSON(a.url,function(b){g.footer.show(),h[a.url]=b,a.callback&&a.callback(b,g)})):(this.setContent(t),this.footer&&this.footer.hide(),$.ajax({url:a.url,dataType:a.dataType,success:function(b){h[a.url]=b,g.footer&&g.footer.show(),g.setContent(b),a.callback&&a.callback(b,g)}})));var k=a.position;return k&&this.node.css({left:k[0]+"px",top:k[1]+"px"}),"boolean"==typeof a.autoupdate&&(this.config.autoupdate=a.autoupdate),"boolean"==typeof a.isStick&&(a.isStick?this.node.css("position","absolute"):this.node.css("position","fixed"),this.config.isStick=a.isStick),this.update()},update:function(){return this.updateSize(),this.updatePosition(),this},setContent:function(a){return this.body.html(a),this.update()},setTitle:function(a){return $("h3",this.title).html(a),this},submit:function(a){var b=$("form",this.node);b.submit(function(b){b.preventDefault();var c=this.getAttribute("action",2),d=this.getAttribute("method")||"get",e=C(this);$[d.toLowerCase()](c,e,function(b){a&&a(b)},"json")}),b.submit()},open:function(){this.node.appendTo("body").css("visibility","visible").show();var a=this,b=this.config,c=a.body[0];return a.contentHeight=c.offsetHeight,this.watcher=b.autoupdate?setInterval(function(){c.offsetHeight!==a.contentHeight&&(a.update(),a.contentHeight=c.offsetHeight)},100):0,b.modal&&this.msk.show().css({height:$(document).height()}),this},close:function(){return this.node.hide(),this.msk.hide(),this.node.trigger("dialog:close",this),clearInterval(this.watcher),this}},c.Dialog=function(a,b){return!b&&f?a?f.set(a):f:f||b?new D(a):f=new D(a)},window.dui=c;var E={}}();