angular.module("fmApp").factory("musician",["$http","$q","helper",function(a,b,c){"use strict";var d={};return{loadSongs:function(e){var f=b.defer(),g="http://music.douban.com/musician/"+e,h=[];return d.hasOwnProperty(e)?(h=d[e],f.resolve(h)):a({method:"get",url:g,timeout:3e4,withCredentials:!0}).success(function(a){a=a.replace(/src=/gi,"data-src=");var b=$($.parseHTML(a)),i=b.find("#headline").find(".info h1"),j=b.find(".song-items-wrapper"),k=j.find(".song-item"),l=$.trim(i.text());k.length&&(h=$.map(k,function(a){var b=$(a),d=b.attr("id"),e=b.data("ssid"),f=b.find(".song-name-short").data("title");return f?{id:d,ssid:e,title:c.fixFilename(f),album:"",fmUrl:c.fmUrl(d,e),albumUrl:"",albumId:"",artist:l,artistUrl:g}:void 0})),d[e]=h,f.resolve(h)}).error(function(){f.reject()}),f.promise}}}]);