angular.module("fmApp").controller("RethotController",["$scope","mine","baidu","download",function(a,b,c,d){"use strict";function e(b){angular.forEach(a.data.songs,function(a){a.checked=b})}a.alert={},a.data={},a.status={},a.songs=[],a.allChecked=!1,a.page=0,a.loadRethot=function(c){a.page=c,b.rethot(c).then(function(b){a.data=b,angular.forEach(b.songs,function(a){d.findItem(a.id).then(function(b){d.updateStatus(a,b)})}),e(a.allChecked),a.status.error=!1,a.status.loaded=!0,b.songs.length||(a.status.ended=!0)},function(){a.status.error=!0})},a.downloadSong=function(a){c.search({title:a.title,artist:a.artist,album:a.subject_title}).then(function(b){a.url=b,chrome.downloads.download({filename:a.title+" - "+a.artist+".mp3",url:b},function(b){d.add(a,b),a.downloadId=b})},function(){a.error=!0})},a.pauseDownload=function(a){var b=a.downloadId;b&&chrome.downloads.pause(b,function(){a.isPaused=!0})},a.resumeDownload=function(a){var b=a.downloadId;b&&chrome.downloads.resume(b,function(){a.isPaused=!1})},chrome.downloads.onChanged.addListener(function(b){d.findSong(a.data.songs,b.id).then(function(a){d.updateStatus(a,b)})}),a.$watch("allChecked",function(a){e(a)}),a.loadRethot(1)}]);