define(function(require,a,b){"use strict";var c=require("jquery"),d={},e={subjectId:function(a){a=""+a;var b=a.match(/subject\/(\w+)\//i),c=b?b[1]:"";return c},subjectList:function(a){var b=new c.Deferred;return a?c.get(a).done(function(a){var d=c(c.parseHTML(a)),e=d.find(".song-item"),f=[];e.each(function(){var a=c(this);f.push({sid:a.attr("id"),ssid:a.data("ssid")})}),f.length?b.resolve(f):b.reject()}).fail(function(){b.reject()}):b.reject(),b.promise()},equalNum:function(a,b){return"str"!==c.type(a)&&(a=""+a),a.match(b)?!0:!1},findById:function(a,b){for(var c=null,d=0,e=a.length;e>d;d+=1)if(this.equalNum(a[d].sid,b)){c=a[d];break}return c},fmLink:function(a,b,c){var d="http://douban.fm/?start=#sid#g#ssid#g#channel#&cid=#cid#",e=0;return"undefined"==typeof c?c=2e6+parseInt(a,10):e=c,d=d.replace("#ssid#",b).replace("#sid#",a).replace("#cid#",c).replace("#channel#",e)},search:function(a){var b=new c.Deferred,e="";return a+=" @豆瓣FM",e="http://s.weibo.com/wb/"+encodeURIComponent(a),d[a]?b.resolve(d[a]):c.ajax({type:"get",url:e,xhrFields:{withCredentials:!0}}).done(function(f){var g=f.match(/"pid":"pl_wb_feedlist".+,"html":(".*")}\)<\/script>/),h=[],i=null,j="";g&&g.length>1&&(j=g[1]);try{j=c.parseJSON(j),i=c(c.parseHTML(j)),i.find(".feed_list").each(function(){var a=c(this),b=a.find("em").eq(0),d=b.find('a[title^="http://douban.fm"]'),e=a.find(".piclist img.bigcursor").eq(0);d.length&&(d.remove(),h.push({title:b.text(),url:d.attr("title"),img:e.attr("src")}))})}catch(k){h=[{title:"可能是搜索太频繁，需要验证码，点击查看具体事项。",url:e,target:"_blank",img:""}]}d[a]=h,b.resolve(h)}).fail(function(){b.reject()}),b.promise()}};b.exports=e});