define(function(require,a,b){"use strict";var c=require("jquery"),d={subjectId:function(a){a=""+a;var b=a.match(/subject\/(\w+)\//i),c=b?b[1]:"";return c},subjectList:function(a){var b=new c.Deferred;return a?c.get(a).done(function(a){var d=c(c.parseHTML(a)),e=d.find(".song-item"),f=[];e.each(function(){var a=c(this);f.push({sid:a.attr("id"),ssid:a.data("ssid")})}),f.length?b.resolve(f):b.reject()}).fail(function(){b.reject()}):b.reject(),b.promise()},equalNum:function(a,b){return"str"!==c.type(a)&&(a=""+a),a.match(b)?!0:!1},findById:function(a,b){for(var c=null,d=0,e=a.length;e>d;d+=1)if(this.equalNum(a[d].sid,b)){c=a[d];break}return c},fmLink:function(a,b,c){var d="http://douban.fm/?start=#sid#g#ssid#g#channel#&cid=#cid#",e=0;return"undefined"==typeof c?c=2e6+parseInt(a,10):e=c,d=d.replace("#ssid#",b).replace("#sid#",a).replace("#cid#",c).replace("#channel#",e)},search:function(a){var b=new c.Deferred;return a+=" @豆瓣FM",c.ajax({type:"get",url:"http://s.weibo.com/wb/"+encodeURIComponent(a),xhrFields:{withCredentials:!0}}).done(function(a){var d=a.match(/"pid":"pl_wb_feedlist".+,"html":(".*")}\)<\/script>/),e=[],f=null,g="";d&&d.length>1&&(g=d[1]),g=c.parseJSON(g),f=c(c.parseHTML(g)),f.find(".feed_list").each(function(){var a=c(this),b=a.find("em").eq(0),d=b.find('a[title^="http://douban.fm"]'),f=a.find(".piclist img.bigcursor").eq(0);d.remove(),e.push({title:b.text(),url:d.attr("title"),img:f.attr("src")})}),b.resolve(e)}).fail(function(){b.reject()}),b.promise()}};b.exports=d});